# Rutube Auto-Uploader (Final Working Version)

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫–∞—á–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ —Å YouTube –∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∏—Ö –Ω–∞ Rutube, –∏—Å–ø–æ–ª—å–∑—É—è –º–µ—Ç–æ–¥ **Webhook + Local Server**.

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

*   **`sync_production.py`** ‚Äî üèÜ **–ì–ª–∞–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç**.
    1.  –°–∫–∞–Ω–∏—Ä—É–µ—Ç **–∫–æ—Ä–µ–Ω—å –∫–∞–Ω–∞–ª–∞** YouTube (–≤–∫–ª—é—á–∞–µ—Ç –∏ `/videos`, –∏ `/shorts`).
    2.  –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –±–∞–∑—É `sync_db.sqlite`, —á—Ç–æ–±—ã –Ω–µ –∑–∞–≥—Ä—É–∂–∞—Ç—å –¥—É–±–ª–∏.
    3.  –ò–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –≤–∏–¥–µ–æ —Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π (—á—Ç–æ–±—ã –Ω–µ –≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ –≤–∏–¥–µ–æ).
    4.  –ó–∞ –æ–¥–∏–Ω –∑–∞–ø—É—Å–∫ –∑–∞–≥—Ä—É–∂–∞–µ—Ç **—Ä–æ–≤–Ω–æ –æ–¥–Ω–æ** —Å–∞–º–æ–µ —Å—Ç–∞—Ä–æ–µ –∏–∑ –Ω–æ–≤—ã—Ö –≤–∏–¥–µ–æ (–ª–∏–º–∏—Ç 1 –≤–∏–¥–µ–æ / 3 —á–∞—Å–∞).
    5.  –ü–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç **–ø–æ–ª–Ω–æ–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ** —Å YouTube.
    6.  **UPDATE 2026:** –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤–∏–¥–µ–æ –Ω–∞ –≤–Ω–µ—à–Ω–∏–π –æ–±–º–µ–Ω–Ω–∏–∫ (Catbox.moe), –ø–æ–ª—É—á–∞–µ—Ç –ø—Ä—è–º—É—é —Å—Å—ã–ª–∫—É –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ—ë –≤ Rutube. (–õ–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–∞).
    7.  –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Å—ã–ª–∫—É –≤ Rutube API –∫–∞–∫ **–ü—É–±–ª–∏—á–Ω–æ–µ** (`is_hidden=False`).
*   **`server_simple.py`** ‚Äî –õ–æ–∫–∞–ª—å–Ω—ã–π HTTP-—Å–µ—Ä–≤–µ—Ä (–ø–æ—Ä—Ç 5005). –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω –≤—Å–µ–≥–¥–∞.
*   **`scheduler.py`** ‚Äî –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫, –∑–∞–ø—É—Å–∫–∞—é—â–∏–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –∫–∞–∂–¥—ã–µ 3 —á–∞—Å–∞.
*   **`config.py`** ‚Äî –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ–º–µ–Ω–∞ –∏ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å–∫–∞—Ç—å

### 1. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ (–≤ —Ñ–æ–Ω–µ)
```bash
nohup python3 server_simple.py > server.log 2>&1 &
```

### 2. –ó–∞–ø—É—Å–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ (–≤ —Ñ–æ–Ω–µ)
```bash
nohup python3 scheduler.py > scheduler.log 2>&1 &
```

## ‚úÖ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã —Å Shorts
–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç Shorts. –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–≥–æ –≤–∏–¥–µ–æ (9:16) –Ω–∞ Rutube, –æ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Ä–∞–∑–¥–µ–ª –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã. –ú—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª–∏ —ç—Ç–æ –Ω–∞ –≤–∏–¥–µ–æ "–ó–æ–ª–æ—Ç–∏—Å—Ç–∞—è –≤–µ—Ä–º–∏—à–µ–ª—å", "–ü–∏–∫–∞–Ω—Ç–Ω–æ–µ —Ä–∞–≥—É" –∏ "–ß–µ—Å–Ω–æ—á–Ω—ã–µ –¥—Ä–∞–Ω–∏–∫–∏".

## üõ† –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ
*   **–ñ—É—Ä–Ω–∞–ª:** –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–∏—à—É—Ç—Å—è –≤ `experiment_log.md`.
*   **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö ID —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `sync_db.sqlite`.
*   **–û—à–∏–±–∫–∏:** –ï—Å–ª–∏ YouTube –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ (403 Forbidden), –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å `yt-dlp` –∏–ª–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç–µ –∫—É–∫–∏ –≤ `sync_production.py` (—Å–µ–π—á–∞—Å –æ–Ω–∏ –æ—Ç–∫–ª—é—á–µ–Ω—ã –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏).

---

## üó∫ –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ GitHub Actions (Yandex Object Storage)

–î–ª—è –∑–∞–ø—É—Å–∫–∞ –≤ –æ–±–ª–∞–∫–µ (GitHub Actions) –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ –±—É–¥–µ—Ç. –ù—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å S3-—Ö—Ä–∞–Ω–∏–ª–∏—â–µ (Yandex Object Storage) –∫–∞–∫ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π –±—É—Ñ–µ—Ä.

### –ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–≤ –±—É–¥—É—â–µ–º):
1.  **GitHub Action** –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é.
2.  –°–∫–∞—á–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ —Å YouTube.
3.  –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤–∏–¥–µ–æ –≤ **Yandex Object Storage**.
4.  –ü–æ–ª—É—á–∞–µ—Ç –ø—É–±–ª–∏—á–Ω—É—é —Å—Å—ã–ª–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, `https://storage.yandexcloud.net/my-bucket/video.mp4`).
5.  –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —ç—Ç—É —Å—Å—ã–ª–∫—É –≤ Rutube API.
6.  –£–¥–∞–ª—è–µ—Ç –≤–∏–¥–µ–æ –∏–∑ S3 (—á—Ç–æ–±—ã –Ω–µ –ø–ª–∞—Ç–∏—Ç—å –∑–∞ —Ö—Ä–∞–Ω–µ–Ω–∏–µ).

### üîë –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –∫–ª—é—á–∏ Yandex S3

–í–∞–º –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è `AWS_ACCESS_KEY_ID` –∏ `AWS_SECRET_ACCESS_KEY`.

1.  **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:**
    *   –ó–∞–π–¥–∏—Ç–µ –≤ [–ö–æ–Ω—Å–æ–ª—å Yandex Cloud](https://console.cloud.yandex.ru/).
    *   –°–æ–∑–¥–∞–π—Ç–µ –ø–ª–∞—Ç–µ–∂–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç (–Ω—É–∂–Ω–∞ –∫–∞—Ä—Ç–∞, —Å–ø–∏—à—É—Ç –ø–∞—Ä—É —Ä—É–±–ª–µ–π).
2.  **–°–æ–∑–¥–∞–Ω–∏–µ –ë–∞–∫–µ—Ç–∞ (–í–µ–¥—Ä–∞):**
    *   –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Å–µ—Ä–≤–∏—Å **Object Storage**.
    *   –ù–∞–∂–º–∏—Ç–µ **"–°–æ–∑–¥–∞—Ç—å –±–∞–∫–µ—Ç"**.
    *   –ò–º—è: —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `rutube-buffer-2026`).
    *   –î–æ—Å—Ç—É–ø: **–ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø** -> **–ù–∞ —á—Ç–µ–Ω–∏–µ** (—á—Ç–æ–±—ã Rutube –º–æ–≥ —Å–∫–∞—á–∞—Ç—å).
3.  **–°–æ–∑–¥–∞–Ω–∏–µ –°–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –ê–∫–∫–∞—É–Ω—Ç–∞ (–ë–æ—Ç–∞):**
    *   –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –∫–∞—Ç–∞–ª–æ–≥ (–ø–∞–ø–∫—É), –≥–¥–µ —Å–æ–∑–¥–∞–ª–∏ –±–∞–∫–µ—Ç.
    *   –í –º–µ–Ω—é —Å–ª–µ–≤–∞ –≤—ã–±–µ—Ä–∏—Ç–µ **"–°–µ—Ä–≤–∏—Å–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã"**.
    *   –ù–∞–∂–º–∏—Ç–µ **"–°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç"**.
    *   –ò–º—è: `uploader-bot`.
    *   **–†–æ–ª–∏:** –î–æ–±–∞–≤—å—Ç–µ —Ä–æ–ª—å `storage.editor` (—á—Ç–æ–±—ã –æ–Ω –º–æ–≥ –≥—Ä—É–∑–∏—Ç—å –∏ —É–¥–∞–ª—è—Ç—å —Ñ–∞–π–ª—ã).
4.  **–ü–æ–ª—É—á–µ–Ω–∏–µ –ö–ª—é—á–µ–π:**
    *   –ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç `uploader-bot`.
    *   –í–≤–µ—Ä—Ö—É –Ω–∞–∂–º–∏—Ç–µ **"–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫–ª—é—á"** -> **"–°–æ–∑–¥–∞—Ç—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∫–ª—é—á –¥–æ—Å—Ç—É–ø–∞"**.
    *   –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–ª—é—á–∞** (—ç—Ç–æ Access Key).
    *   –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **–°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á** (—ç—Ç–æ Secret Key). **–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –µ–≥–æ —Å—Ä–∞–∑—É, –æ–Ω –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑!**

–≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –≤—ã –ø–æ—Ç–æ–º –ø—Ä–æ–ø–∏—à–µ—Ç–µ –≤ Secrets –≤–∞—à–µ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –Ω–∞ GitHub.
