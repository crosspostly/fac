import json
import os

# Оригинальная строка JSON от пользователя
cookies_raw_str = """
[{"domain":".www.tiktok.com","expirationDate":1794659602,"hostOnly":false,"httpOnly":false,"name":"tiktok_webapp_theme_source","path":"/","sameSite":"unspecified","secure":true,"session":false,"storeId":"0","value":"auto"},{"domain":".www.tiktok.com","expirationDate":1794659602,"hostOnly":false,"httpOnly":false,"name":"tiktok_webapp_theme","path":"/","sameSite":"unspecified","secure":true,"session":false,"storeId":"0","value":"dark"},{"domain":".www.tiktok.com","expirationDate":1791477257,"hostOnly":false,"httpOnly":false,"name":"delay_guest_mode_vid","path":"/","sameSite":"unspecified","secure":true,"session":false,"storeId":"0","value":"5"},{"domain":".tiktok.com","hostOnly":false,"httpOnly":true,"name":"tt_csrf_token","path":"/","sameSite":"lax","secure":true,"session":true,"storeId":"0","value":"6dKBlMv9-LZtrXJriimaoa4HR7Uf3Ct9QgHI"},{"domain":".tiktok.com","expirationDate":1772820695.949268,"hostOnly":false,"httpOnly":false,"name":"passport_csrf_token","path":"/","sameSite":"no_restriction","secure":true,"session":false,"storeId":"0","value":"72cd38409e9f2241663ce7e19868ffe2"},{"domain":".tiktok.com","expirationDate":1772820695.949903,"hostOnly":false,"httpOnly":false,"name":"passport_csrf_token_default","path":"/","sameSite":"unspecified","secure":true,"session":false,"storeId":"0","value":"72cd38409e9f2241663ce7e19868ffe2"},{"domain":".tiktok.com","hostOnly":false,"httpOnly":false,"name":"s_v_web_id","path":"/","sameSite":"no_restriction","secure":true,"session":true,"storeId":"0","value":"verify_mk1h8yyj_0KA4DjPM_Wb8l_4iiy_Bxxb_82CkpgpIKRuF"},{"domain":".tiktok.com","expirationDate":1801635700,"hostOnly":false,"httpOnly":false,"name":"cookie-consent","path":"/","sameSite":"no_restriction","secure":true,"session":false,"storeId":"0","value":"{%22optional%22:true%2C%22ga%22:true%2C%22af%22:true%2C%22fbp%22:true%2C%22lip%22:true%2C%22bing%22:true%2C%22ttads%22:true%2C%22reddit%22:true%2C%22hubspot%22:true%2C%22version%22:%22v10%22}"},{"domain":".www.tiktok.com","hostOnly":false,"httpOnly":false,"name":"passport_fe_beating_status","path":"/","sameSite":"unspecified","secure":false,"session":true,"storeId":"0","value":"true"},{"domain":"www.tiktok.com","hostOnly":true,"httpOnly":false,"name":"csrf_session_id","path":"/","sameSite":"no_restriction","secure":true,"session":true,"storeId":"0","value":"9279bab36b83bbb227cd9b4682908fc4"},{"domain":"www.tiktok.com","expirationDate":1799599533.657367,"hostOnly":true,"httpOnly":false,"name":"pre_country","path":"/","sameSite":"unspecified","secure":false,"session":false,"storeId":"0","value":"FI"},{"domain":"www.tiktok.com","expirationDate":1799599533.657775,"hostOnly":true,"httpOnly":false,"name":"lang_type","path":"/","sameSite":"unspecified","secure":false,"session":false,"storeId":"0","value":"en"},{"domain":".tiktok.com","expirationDate":1784291595.061149,"hostOnly":false,"httpOnly":true,"name":"tt_chain_token","path":"/","sameSite":"unspecified","secure":true,"session":false,"storeId":"0","value":"FrNQJyVQ2aG/XUl2ClcXag=="},{"domain":".tiktok.com","expirationDate":1799600808.039633,"hostOnly":false,"httpOnly":true,"name":"d_ticket","path":"/","sameSite":"unspecified","secure":false,"session":false,"storeId":"0","value":"7575931aae6d801cb7926b5f04c5d1910907a"},{"domain":".www.tiktok.com","expirationDate":1799603059,"hostOnly":false,"httpOnly":false,"name":"fbm_1862952583919182","path":"/","sameSite":"no_restriction","secure":true,"session":false,"storeId":"0","value":"base_domain=.www.tiktok.com"},{"domain":".tiktok.com","expirationDate":1770659062.990532,"hostOnly":false,"httpOnly":true,"name":"passport_auth_status","path":"/","sameSite":"unspecified","secure":false,"session":false,"storeId":"0","value":"bef1d437114aea063d8fbaffcaaa830a%2Cd5ff3e590378a2193512de64ab28f3b9"},{"domain":".tiktok.com","expirationDate":1770659062.990625,"hostOnly":false,"httpOnly":true,"name":"passport_auth_status_ss","path":"/","sameSite":"no_restriction","secure":true,"session":false,"storeId":"0","value":"bef1d437114aea063d8fbaffcaaa830a%2Cd5ff3e590378a2193512de64ab28f3b9"},{"domain":".www.tiktok.com","expirationDate":1768807078,"hostOnly":false,"httpOnly":false,"name":"__tea_cache_tokens_1988","path":"/","sameSite":"unspecified","secure":false,"session":false,"storeId":"0","value":"{%22web_id%22:%227583010493804594699%22%2C%22user_unique_id%22:%227593775525299586582%22%2C%22timestamp%22:1768200726466%2C%22_type_%22:%22default%22}"},{"domain":".tiktok.com","expirationDate":1773923593.352416,"hostOnly":false,"httpOnly":true,"name":"multi_sids","path":"/","sameSite":"unspecified","secure":True,"session":False,"storeId":"0","value":"7593776063446565910%3A4d7f61e789850a2a6845c8bbf8476497%7C7428529717945041962%3A231fc03820262097316e075e02ea31a4"},{"domain":".tiktok.com","expirationDate":1773923593.352939,"hostOnly":false,"httpOnly":true,"name":"cmpl_token","path":"/","sameSite":"unspecified","secure":True,"session":False,"storeId":"0","value":"AgQQAPNSF-RO0rcpnswpvt0T8wMbqP4Wv5QeYKJIpQ"},{"domain":".tiktok.com","expirationDate":1799843593.353074,"hostOnly":false,"httpOnly":true,"name":"sid_guard","path":"/","sameSite":"unspecified","secure":True,"session":False,"storeId":"0","value":"231fc03820262097316e075e02ea31a4%7C1768739593%7C15552000%7CFri%2C+17-Jul-2026+12%3A33%3A13+GMT"},{"domain":".tiktok.com","expirationDate":1784291593.35326,"hostOnly":false,"httpOnly":true,"name":"uid_tt","path":"/","sameSite":"unspecified","secure":True,"session":False,"storeId":"0","value":"f8dcc3bca77810bfa11edb1e2dbf3f85ceba6f0af6c896653641536c582e4622"},{"domain":".tiktok.com","expirationDate":1784291593.353602,"hostOnly":false,"httpOnly":true,"name":"uid_tt_ss","path":"/","sameSite":"no_restriction","secure":True,"session":False,"storeId":"0","value":"f8dcc3bca77810bfa11edb1e2dbf3f85ceba6f0af6c896653641536c582e4622"},{"domain":".tiktok.com","expirationDate":1784291593.353766,"hostOnly":false,"httpOnly":true,"name":"sid_tt","path":"/","sameSite":"unspecified","secure":True,"session":False,"storeId":"0","value":"231fc03820262097316e075e02ea31a4"},{"domain":".tiktok.com","expirationDate":1784291593.353904,"hostOnly":false,"httpOnly":true,"name":"sessionid","path":"/","sameSite":"unspecified","secure":True,"session":False,"storeId":"0","value":"231fc03820262097316e075e02ea31a4"},{"domain":".tiktok.com","expirationDate":1784291593.35409,"hostOnly":false,"httpOnly":true,"name":"sessionid_ss","path":"/","sameSite":"no_restriction","secure":True,"session":False,"storeId":"0","value":"231fc03820262097316e075e02ea31a4"},{"domain":".tiktok.com","expirationDate":1784291593.35418,"hostOnly":false,"httpOnly":true,"name":"tt_session_tlb_tag","path":"/","sameSite":"no_restriction","secure":True,"session":False,"storeId":"0","value":"sttt%7C4%7CIx_AOCAmIJcxbgdeAuoxpP_________lD4cU0ol6HsR5SAO8LXD8eOBe2fMJi2uPu_51wzAQ-N0%3D"},{"domain":".tiktok.com","expirationDate":1784291593.354244,"hostOnly":false,"httpOnly":true,"name":"sid_ucp_v1","path":"/","sameSite":"unspecified","secure":True,"session":False,"storeId":"0","value":"1.0.1-KGI1YzNlYjY2ZjAyZmY3MTcwNWNkOTdkMzEyYzAwYTk1YWQxNDI3OTUKGgiqiLCMuo3ci2cQiaazywYYsws4B0D0B0gEEAQaB3VzZWFzdDUiIDIzMWZjMDM4MjAyNjIwOTczMTZlMDc1ZTAyZWEzMWE0Mk4KIPVs0uNO6O1UjTsHSUKfQ4xz7ytNUq09mBv1gQD4OaRqEiCnDUoH_l14A9HMWJBsNVIEQn8RQ5NuP6T60rvW_jRsfBgFIgZ0aWt0b2s"},{"domain":".tiktok.com","expirationDate":1784291593.354309,"hostOnly":false,"httpOnly":true,"name":"ssid_ucp_v1","path":"/","sameSite":"no_restriction","secure":True,"session":False,"storeId":"0","value":"1.0.1-KGI1YzNlYjY2ZjAyZmY3MTcwNWNkOTdkMzEyYzAwYTk1YWQxNDI3OTUKGgiqiLCMuo3ci2cQiaazywYYsws4B0D0B0gEEAQaB3VzZWFzdDUiIDIzMWZjMDM4MjAyNjIwOTczMTZlMDc1ZTAyZWEzMWE0Mk4KIPVs0uNO6O1UjTsHSUKfQ4xz7ytNUq09mBv1gQD4OaRqEiCnDUoH_l14A9HMWJBsNVIEQn8RQ5NuP6T60rvW_jRsfBgFIgZ0aWt0b2s"},{"domain":".tiktok.com","expirationDate":1800275594.091422,"hostOnly":false,"httpOnly":true,"name":"store-idc","path":"/","sameSite":"unspecified","secure":false,"session":false,"storeId":"0","value":"useast5"},{"domain":".tiktok.com","expirationDate":1800275594.091992,"hostOnly":false,"httpOnly":true,"name":"store-country-code","path":"/","sameSite":"unspecified","secure":false,"session":false,"storeId":"0","value":"us"},{"domain":".tiktok.com","expirationDate":1800275594.092189,"hostOnly":false,"httpOnly":true,"name":"store-country-code-src","path":"/","sameSite":"unspecified","secure":false,"session":false,"storeId":"0","value":"uid"},{"domain":".tiktok.com","expirationDate":1800275594.09238,"hostOnly":false,"httpOnly":true,"name":"tt-target-idc","path":"/","sameSite":"unspecified","secure":false,"session":false,"storeId":"0","value":"useast5"},{"domain":".tiktok.com","expirationDate":1800275594.09257,"hostOnly":false,"httpOnly":true,"name":"tt-target-idc-sign","path":"/","sameSite":"unspecified","secure":false,"session":false,"storeId":"0","value":"JzKXasXXf4fpcFez9hCYM9e5JjZRje9S1lJMikn5ki7qgvLjtnlmQQo0nWwy4ejqtqIPGHMLXt3_Mfq0Jk5nGhf2IQGX4AMR2SOsOneOBPMULHPm-qWOGiVf5wKe49t7NfCCzNckJmxNflW39UtPMQWtfXnvUEDx0AwAGgQRy0_SZxw8nF2Pye5pD_IHspoNvDfpjXyCfQE-QdK4SgQOrWKsL_w1SyDGsF3cSZV9i17eNe8OTAorWr9l4KSngFD4VFpLxSCfSSEx67z_dBeK-aHfNDUdV7mIfjxyT1M7AaG5uSCrQtLdnrBUuYqhj6XH9CpeccHoU6Un_7_gdQo-Wx7RB7UkdsTFZ9Vk3Q3flhxmsOYFbj7F-B7SmmEe48PGeihszYTbDUvWbKHN7BWVVsrVrnaAhQWrbIRY_8DMersPNljhjC0Yyo3THC2pCH3RD3_NqyqOzXtogRUCb7raJNNwdoUmguR6YK-q_lafdSfNyTbGQwTHvW0IUv6wbc2m"},{"domain":"www.tiktok.com","expirationDate":1776515593,"hostOnly":true,"httpOnly":false,"name":"last_login_method","path":"/","sameSite":"unspecified","secure":false,"session":false,"storeId":"0","value":"QRcode"},{"domain":".tiktok.com","expirationDate":1800275594.091733,"hostOnly":false,"httpOnly":true,"name":"store-country-sign","path":"/","sameSite":"unspecified","secure":false,"session":false,"storeId":"0","value":"MEIEDK7nrlh0nxYrYXjLGQQgIpvQRZwVRWhKpgHZlN5KF4bNSHHrgzEXTzVDTKnO7NUEEGfEcL7G39dzBhqH0bkpuv0"},{"domain":".tiktok.com","expirationDate":1800275605.092373,"hostOnly":false,"httpOnly":true,"name":"odin_tt","path":"/","sameSite":"unspecified","secure":false,"session":false,"storeId":"0","value":"2a3a71d5fa5cdecd43f31cd27e4bebf862279be8c7225707b097f4054dd5d26bcfba42348b0910d001e340a44a41e695fea42cd8908bf1df3924499481201386f1136938545bbc24d35efe5578f71e49"},{"domain":".www.tiktok.com","expirationDate":1769344406,"hostOnly":false,"httpOnly":false,"name":"perf_feed_cache","path":"/","sameSite":"unspecified","secure":true,"session":false,"storeId":"0","value":"{%22expireTimestamp%22:1768910400000%2C%22itemIds%22:[%227581566889386724630%22%2C%227586222529409273095%22%2C%227589275268880059670%22]}"},{"domain":".tiktok.com","expirationDate":1800275609.669934,"hostOnly":false,"httpOnly":true,"name":"ttwid","path":"/","sameSite":"no_restriction","secure":true,"session":false,"storeId":"0","value":"1%7CHDyvsxOhgmkQ1tMOjOdcinIZrBGwxIqw5sCIn_IXkQI%7C1768739609%7Cc23bf1193c06e0ec5b377a6087ef9d055af99ec13769784e5964278f37aef357"},{"domain":".tiktok.com","expirationDate":1769603620.802872,"hostOnly":false,"httpOnly":false,"name":"msToken","path":"/","sameSite":"no_restriction","secure":true,"session":false,"storeId":"0","value":"gvlCqQrib1Yc1RVSv0bFlRLJYYPhg82zvD5dEcK-xw9AIfZQHCbquVlQEJRqNXtZ4u0KrRKT4SFuS0GrQ0lEOHtYeC_x5IV5K5QAIJr6jPWCl5xmf6lGCl01b2QfjrHT5Tdsjhq-wvljtzv2UqV9V2O11Q=="},{"domain":"www.tiktok.com","expirationDate":1776515624,"hostOnly":true,"httpOnly":false,"name":"msToken","path":"/","sameSite":"unspecified","secure":false,"session":false,"storeId":"0","value":"V_F5qmz0yma6nuEwamHVElo9g_phWczE6fG3NtfwxX0tOOSuenG4UCT-MJbbGqQpKTMPeD4qkPZM-bJ462hOvuhvYaOoeO2DtuHg_FJZZo0C58chkgRersArsC4Sc8uhirUzGbblDb-GF-SeDvFsvRko-A=="}] 
"""

# В JSON-строке уже должны быть true/false (маленькие), 
# но в тексте выше я вижу смесь.
# Самый верный способ - почистить строку до чистого JSON.
import re

# Убираем возможные лишние символы в начале/конце
json_match = re.search(r'[[].*[]]', cookies_raw_str, re.DOTALL)
if json_match:
    clean_json_str = json_match.group(0)
    # Заменяем Python-style True/False на JSON-style true/false если они там есть
    clean_json_str = clean_json_str.replace("True", "true").replace("False", "false")
    
    try:
        cookies_json = json.loads(clean_json_str)
    except Exception as e:
        print(f"JSON load error: {e}")
        exit(1)
else:
    print("Could not find JSON array in string")
    exit(1)

output_path = "insta_tok/tiktok_cookies.txt"

def convert_to_netscape(cookies):
    lines = ["# Netscape HTTP Cookie File\n", "# http://curl.haxx.se/rfc/cookie_spec.html\n", "# This is a generated file!  Do not edit.\n\n"]
    for c in cookies:
        domain = c.get('domain', '')
        if not domain: continue
        flag = "TRUE" if domain.startswith('.') else "FALSE"
        path = c.get('path', '/')
        secure = "TRUE" if c.get('secure', False) else "FALSE"
        # Use a very distant future if no expiration
        expiration = int(c.get('expirationDate', 2147483647))
        name = c.get('name', '')
        value = c.get('value', '')
        lines.append(f"{domain}\t{flag}\t{path}\t{secure}\t{expiration}\t{name}\t{value}\n")
    return lines

with open(output_path, "w") as f:
    f.writelines(convert_to_netscape(cookies_json))

print(f"✅ Файл {output_path} успешно создан.")